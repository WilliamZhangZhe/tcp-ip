### HTTP2

http2是针对http1.x的缺点的改进版本，并为改变http1.x所具有的基本的header、uri、method、statuscode这些http核心概念，它的改进的核心内容为采用二进制分帧层来对数据传输进行编码，来实现连接多路复用，减少不必要的TCP连接。

* ##### HTTP2 相比 HTTP1.x的改进内容

  1. 针对单资源服务器可多路复用一个TCP连接获取所有所需资源，不必像1.x那样使用多个TCP连接来实现多个资源的并发请求。
  2. 采用数据流、消息、二进制帧的方式来控制请求及相应，在一个双向数据流中同时传输多个消息的数据帧，提高传输效率，数据流类比于一个完整的请求-响应，消息对应于独立的请求或者响应，帧对应于消息的片段

  3. 可设置数据流优先级（依赖关系、权重）

  4. 在应用层实现传输流控功能，通过与传输层类似的通告窗口实现
  5. 服务器可主动推送内容，客户端有选择拒绝的权利
  6. 采用HPACK压缩标头，在初次请求交换完header后，之后的请求可不必传输重复的内容

#### 详细介绍参考 [https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn](https://developers.google.com/web/fundamentals/performance/http2/?hl=zh-cn)

#### 二进制分帧层

HTTP/2 所有性能增强的核心在于新的二进制分帧层，它定义了如何封装 HTTP 消息并在客户端与服务器之间传输。![](/assets/1557404120054.jpg)这里所谓的“层”，指的是位于套接字接口与应用可见的高级 HTTP API 之间一个经过优化的新编码机制：HTTP 的语义（包括各种动词、方法、标头）都不受影响，不同的是传输期间对它们的编码方式变了。 HTTP/1.x 协议以换行符作为纯文本的分隔符，而 HTTP/2 将所有传输的信息分割为更小的消息和帧，并采用二进制格式对它们编码。

这样一来，客户端和服务器为了相互理解，都必须使用新的二进制编码机制：HTTP/1.x 客户端无法理解只支持 HTTP/2 的服务器，反之亦然。 不过不要紧，现有的应用不必担心这些变化，因为客户端和服务器会替我们完成必要的分帧工作。



#### 数据流、消息和帧

新的二进制分帧机制改变了客户端与服务器之间交换数据的方式。 为了说明这个过程，我们需要了解 HTTP/2 的三个概念：

* _数据流_：已建立的连接内的双向字节流，可以承载一条或多条消息。
* _消息_：与逻辑请求或响应消息对应的完整的一系列帧。
* _帧_：HTTP/2 通信的最小单位，每个帧都包含帧头，至少也会标识出当前帧所属的数据流。

这些概念的关系总结如下：

* 所有通信都在一个 TCP 连接上完成，此连接可以承载任意数量的双向数据流。
* 每个数据流都有一个唯一的标识符和可选的优先级信息，用于承载双向消息。
* 每条消息都是一条逻辑 HTTP 消息（例如请求或响应），包含一个或多个帧。
* 帧是最小的通信单位，承载着特定类型的数据，例如 HTTP 标头、消息负载等等。 来自不同数据流的帧可以交错发送，然后再根据每个帧头的数据流标识符重新组装。![](/assets/2.jpg)简言之，HTTP/2 将 HTTP 协议通信分解为二进制编码帧的交换，这些帧对应着特定数据流中的消息。所有这些都在一个 TCP 连接内复用。 这是 HTTP/2 协议所有其他功能和性能优化的基础。





